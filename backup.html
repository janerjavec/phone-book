<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Address Book</title>
<style>
    /* Styles for the address book */
    #address-book {
        font-family: Arial, sans-serif;
        width: 300px;
        margin: 0 auto;
        position: relative;
    }
    #address-book h2 {
        text-align: center;
    }
    .letter-block {
        margin-top: 10px;
    }
    .letter {
        font-size: 20px;
        font-weight: bold;
        margin-top: 10px;
    }
    .contact-list {
        list-style-type: none;
        padding: 0;
    }
    .contact-item {
        cursor: pointer;
        margin-bottom: 5px;
        padding: 5px;
        background-color: #f2f2f2;
        border-radius: 5px;
    }
    .contact-item:hover {
        background-color: #e6e6e6;
    }
    .contact-details {
        margin-top: 5px;
        padding: 5px;
        display: none;
    }
    .remove-contact {
        text-align: center;
        margin-top: 5px;
    }
    #search-bar {
        width: calc(100% - 24px);
        padding: 5px;
        box-sizing: border-box;
        margin-bottom: 10px;
    }


    /* Styles for the modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
        padding-top: 60px;
    }
    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border-radius: 5px;
        width: 20%;
    }
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }
    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
    .input-container {
        margin-bottom: 10px;
    }
    .input-container label {
        display: block;
        margin-bottom: 5px;
    }
    .input-container input {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
    }
    .btn-container {
        text-align: center;
    }
    .search-container {
    position: relative;
}

#search-bar {
    width: 100%;
}

#cancel-search-btn {
    background-color: transparent;
    position: absolute;
    right: 0;
    top: 0;
    height: 30px;
    border: none;
    padding: 0 10px;
    cursor: pointer;
    display: none; /* Initially hide the button */
}
#create-contact-btn {
    position: absolute;
    top: 0px;
    right: 0px;
}

</style>
</head>
<body>
<div id="address-book">
    <h2>Address Book</h2>
    <div class="search-container">
        <input type="text" id="search-bar" oninput="searchContacts()" placeholder="Search...">
        <button id="cancel-search-btn" onclick="cancelSearch()">Cancel</button>
    </div>
    <button id="create-contact-btn" onclick="openModal()">+</button>
    <div id="contact-container"></div>
</div>

<!-- Modal -->
<div id="create-contact-modal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Add Contact</h2>
        <div class="input-container">
            <label for="nameInput">Name:</label>
            <input type="text" id="nameInput" placeholder="Janez Novak">
        </div>
        <div class="input-container">
            <label for="phoneInput">Phone:</label>
            <input type="text" id="phoneInput" oninput="formatPhoneNumber(this)" placeholder="012 345 678">

            <span id="phoneError" class="error-message"></span>
        </div>
        <div class="input-container">
            <label for="emailInput">Email:</label>
            <input type="text" id="emailInput" placeholder="janez.novak@gmail.com">
        </div>
        <div class="btn-container">
            <button onclick="addAddress()">Add</button>
        </div>
    </div>
</div>

<script>
    let addresses = [];
    let originalAddresses = [];

    // Load addresses from local storage when the page loads
    window.onload = function() {
        const cancelBtn = document.getElementById('cancel-search-btn');
        cancelBtn.addEventListener('click', function() {
            cancelBtn.style.display = 'none';
            document.getElementById('search-bar').style.width = "100%";
        });

        if (localStorage.getItem('addresses')) {
            addresses = JSON.parse(localStorage.getItem('addresses'));
            originalAddresses = addresses.slice(); // Make a copy for reverting to original state
            displayAddresses();
            updateSearchPlaceholder();
        }
        
    };

    function updateSearchPlaceholder() {
        const searchInput = document.getElementById('search-bar');
        searchInput.placeholder = `Search ${addresses.length} contacts`;
    }

    function displayAddresses() {
        // Clear previous content
        document.getElementById('contact-container').innerHTML = '';

        // Sort addresses alphabetically
        addresses.sort((a, b) => a.name.localeCompare(b.name));

        let currentLetter = null;
        let letterBlock = null;

        addresses.forEach((address, index) => {
            const firstLetter = address.name.charAt(0).toUpperCase();

            if (firstLetter !== currentLetter) {
                // Create a new letter block
                currentLetter = firstLetter;
                letterBlock = document.createElement('div');
                letterBlock.className = 'letter-block';
                letterBlock.innerHTML = `<div class="letter">${currentLetter}</div>`;
                document.getElementById('contact-container').appendChild(letterBlock);
            }

            const contactItem = document.createElement('div');
            contactItem.className = 'contact-item';
            contactItem.textContent = address.name;
            letterBlock.appendChild(contactItem);

            const detailsContainer = document.createElement('div');
            detailsContainer.className = 'contact-details';
            detailsContainer.id = `details-${index}`;
            detailsContainer.innerHTML = `
                <p><strong>Phone:</strong> ${address.phone}</p>
                <p><strong>Email:</strong> ${address.email}</p>
                <div class="edit-remove-contact">
                    <button onclick="editContact(${addresses.indexOf(address)})">Edit Contact</button>
                    <button onclick="removeContact(${addresses.indexOf(address)})">Remove Contact</button>
                </div>
            `;
            contactItem.appendChild(detailsContainer);

            contactItem.onclick = function() {
                toggleDetails(detailsContainer);

            };
        });
    }

    function editContact(index) {
        //document.querySelector('#create-contact-modal h2').textContent = "Edit Contact";
        const address = addresses[index];
        document.getElementById('nameInput').value = address.name;
        document.getElementById('phoneInput').value = address.phone;
        document.getElementById('emailInput').value = address.email;
        openModal(); // Open the modal to allow editing
        document.querySelector('#create-contact-modal h2').textContent = "Edit Contact";

        // Add an event listener to the "Add" button in the modal
        const addButton = document.querySelector('#create-contact-modal button');
        addButton.textContent = 'Save'; // Change the button text to "Save"
        addButton.onclick = function() {
            // Get the edited values from the modal inputs
            const editedName = document.getElementById('nameInput').value;
            const editedPhone = document.getElementById('phoneInput').value;
            const editedEmail = document.getElementById('emailInput').value;

            // Update the existing contact with the edited information
            addresses[index] = {
                name: editedName,
                phone: editedPhone,
                email: editedEmail
            };

            // Save the updated addresses to local storage and display them
            saveAddressesToLocalStorage();
            displayAddresses();

            // Close the modal
            closeModal();
        };
    }

    function openModal() {
        document.getElementById('create-contact-modal').style.display = 'block';
        document.querySelector('#create-contact-modal h2').textContent = "Add Contact";
    }

    function closeModal() {
        document.getElementById('create-contact-modal').style.display = 'none';
        clearInputFields(); // Clear input fields when closing the modal
    }

    function clearInputFields() {
        document.getElementById('nameInput').value = '';
        document.getElementById('phoneInput').value = '';
        document.getElementById('emailInput').value = '';
    }

    function addAddress() {
        const name = document.getElementById('nameInput').value;
        const phone = document.getElementById('phoneInput').value;
        const email = document.getElementById('emailInput').value;

        if (name && phone && email) {
            if (phone.startsWith('0')) {
                document.getElementById('phoneError').style.display = 'none';
                const newAddress = { name, phone, email };
                addresses.push(newAddress);
                saveAddressesToLocalStorage();
                displayAddresses();
                closeModal();
            } else {
                document.getElementById('phoneError').style.display = 'block';
            }
        } else {
            alert('Please fill in all fields.');
        }
        updateSearchPlaceholder();
    }

    function saveAddressesToLocalStorage() {
        localStorage.setItem('addresses', JSON.stringify(addresses));
    }

    function formatPhoneNumber(input) {
        // Remove non-digit characters
        let cleaned = input.value.replace(/\D/g, '');

        // Check if it's a valid phone number
        if (cleaned.length > 9) {
            cleaned = cleaned.slice(0, 9);
        }

        // Format the phone number
        const formatted = cleaned.replace(/(\d{3})(\d{3})(\d{3})/, '$1 $2 $3');

        // Update the input value
        input.value = formatted;

        // Check if the first digit is 0
        if (input.value.charAt(0) !== '0' && input.value !== '') {
            document.getElementById('phoneError').textContent = 'Number must start with 0';
        } else {
            document.getElementById('phoneError').textContent = ''; // Clear error message
        }
    }


    function searchContacts() {
        const searchValue = document.getElementById('search-bar').value.toLowerCase();
        const cancelBtn = document.getElementById('cancel-search-btn');

        // Show or hide cancel button based on search input
        if (searchValue.trim() !== '') {
            cancelBtn.style.display = 'block';
            document.getElementById('search-bar').style.width = "240px"; // Change width to 200px

        } else {
            cancelBtn.style.display = 'none';
            document.getElementById('search-bar').style.width = "100%";
            cancelSearch();
            return;
        }
        const matchingAddresses = addresses.filter(address => 
            address.name.toLowerCase().includes(searchValue) ||
            address.phone.toLowerCase().includes(searchValue) ||
            address.email.toLowerCase().includes(searchValue)
        );

        // Clear previous content
        document.getElementById('contact-container').innerHTML = '';

        if (matchingAddresses.length > 0) {
            matchingAddresses.forEach(address => {
                const contactItem = document.createElement('div');
                contactItem.className = 'contact-item';
                contactItem.textContent = address.name;
                document.getElementById('contact-container').appendChild(contactItem);

                const detailsContainer = document.createElement('div');
                detailsContainer.className = 'contact-details';
                detailsContainer.id = `details-${addresses.indexOf(address)}`;
                detailsContainer.innerHTML = `
                    <p><strong>Phone:</strong> ${address.phone}</p>
                    <p><strong>Email:</strong> ${address.email}</p>
                    <div class="remove-contact">
                        <button onclick="removeContact(${addresses.indexOf(address)})">Remove Contact</button>
                    </div>
                `;
                contactItem.appendChild(detailsContainer);
                let phoneHighlight;

                // Highlight matching parts in the phone number
                if (searchValue && address.phone.toLowerCase().includes(searchValue)) {
                    const phoneParts = address.phone.split(searchValue);
                    const formattedPhone = phoneParts.join(`<strong>${searchValue}</strong>`);
                    phoneHighlight = document.createElement('div');
                    phoneHighlight.innerHTML = formattedPhone;
                    phoneHighlight.style.fontWeight = 'normal';
                    phoneHighlight.style.fontSize = '14px';
                    contactItem.appendChild(phoneHighlight);
                }

                contactItem.onclick = function() {
                    if (detailsContainer.style.display === 'block') {
                        // If details are visible, hide them and show phoneHighlight
                        toggleDetails(detailsContainer);
                        phoneHighlight.style.display = 'block';
                    } else {
                        // If details are hidden, show them and hide phoneHighlight
                        toggleDetails(detailsContainer);
                        phoneHighlight.style.display = 'none';
                    }
                };
            });
        } else {
            document.getElementById('contact-container').innerHTML = '<p>No matching contacts found.</p>';
        }
    }

    function toggleDetails(detailsContainer) {
        if (detailsContainer.style.display === 'block') {
            // If details are already visible, hide them
            detailsContainer.style.display = 'none';
        } else {
            // Show details
            detailsContainer.style.display = 'block';
        }
    }

    function removeContact(index) {
        addresses.splice(index, 1);
        localStorage.setItem('addresses', JSON.stringify(addresses));
        displayAddresses();
        updateSearchPlaceholder();
    }

    function cancelSearch() {
        document.getElementById('search-bar').value = '';
        displayAddresses();
    }
</script>
</body>
</html>
